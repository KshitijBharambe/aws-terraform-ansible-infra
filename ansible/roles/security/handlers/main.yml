---
# Security role handlers

- name: Restart SSH
  systemd:
    name: ssh
    state: restarted
  when: ansible_os_family == "Debian"

- name: Restart auditd
  systemd:
    name: auditd
    state: restarted
  when: ansible_os_family == "Debian"

- name: Restart fail2ban
  systemd:
    name: fail2ban
    state: restarted
  when: ansible_os_family == "Debian"

- name: Restart unattended-upgrades
  systemd:
    name: unattended-upgrades
    state: restarted
  when: ansible_os_family == "Debian"

- name: Reload audit rules
  command: augenrules --load
  when: ansible_os_family == "Debian"

- name: Reload SSH configuration
  command: systemctl reload sshd
  when: ansible_os_family == "Debian"

- name: Restart UFW firewall
  systemd:
    name: ufw
    state: restarted
  when: ansible_os_family == "Debian"

- name: Reload firewall rules
  command: ufw --force reload
  when: ansible_os_family == "Debian"

- name: Update AIDE database
  command: aide --update
  when: security_enable_aide | default(false)

- name: Restart audit service
  service:
    name: auditd
    state: restarted
  when: ansible_os_family == "RedHat"

- name: Restart sshd service
  service:
    name: sshd
    state: restarted
  when: ansible_os_family == "RedHat"

- name: Restart iptables
  service:
    name: iptables
    state: restarted
  when: ansible_os_family == "RedHat"

- name: Reload sysctl
  command: sysctl -p
  when: security_kernel_params_updated | default(false)

- name: Reload systemd
  command: systemctl daemon-reload
  when: security_systemd_updated | default(false)
